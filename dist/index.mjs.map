{"version":3,"sources":["../src/types.ts","../src/utils.ts","../src/uploader.ts","../src/index.ts"],"names":["OSSActionError","message","code","statusCode","filePath","ValidationError","NetworkError","FileNotFoundError","validateInputs","inputs","requiredFields","field","timeout","retries","parseUploadRules","assets","rules","line","trimmed","source","destination","p","formatFileSize","bytes","units","size","unitIndex","formatDuration","milliseconds","seconds","minutes","remainingSeconds","hours","calculateBackoffDelay","attempt","baseDelay","maxDelay","multiplier","delay","validateFile","fs","error","getFileStats","basename","parseHeaders","headersString","sanitizeRemotePath","path","ms","resolve","extractRelativePath","basePath","base","relativePath","logOperation","operation","details","logSuccess","logWarning","logError","logDebug","isDebugEnabled","OSSUploader","config","retryConfig","OSS","options","results","startTime","rule","ruleResults","M","sourcePattern","existsSync","statSync","files","fg","isSpecificFile","file","remotePath","filename","result","localPath","fileStats","uploadOptions","response","ossResponse","uploadFn","_filePath","fileSizeFormatted","retryLabel","duration","isLastAttempt","errorMessage","errorObj","delayMs","ossError","totalSize","uploadedSize","run","getActionInputs","ossConfig","createOSSConfig","logConnectionInfo","createRetryConfig","createUploadOptions","uploader","stats","setActionOutputs","createJobSummary","totalTime","customHeaders","r"],"mappings":"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","file":"index.mjs","sourcesContent":["export interface OSSConfig {\n  accessKeyId: string;\n  accessKeySecret: string;\n  bucket: string;\n  region?: string;\n  endpoint?: string;\n  timeout: number;\n  secure?: boolean;\n  cname?: boolean;\n}\n\nexport interface UploadRule {\n  source: string;\n  destination: string;\n  isDirectory: boolean;\n}\n\nexport interface UploadResult {\n  success: boolean;\n  filePath: string;\n  objectKey: string;\n  size: number;\n  etag?: string;\n  url?: string;\n  error?: string;\n}\n\nexport interface UploadStats {\n  totalFiles: number;\n  uploadedFiles: number;\n  failedFiles: number;\n  totalSize: number;\n  uploadedSize: number;\n  totalDuration: number;\n  successRate: number;\n}\n\nexport interface ActionInputs {\n  accessKey: string;\n  secretKey: string;\n  bucket: string;\n  assets: string;\n  region?: string | undefined;\n  endpoint?: string | undefined;\n  timeout?: string | undefined;\n  maxRetries?: string | undefined;\n  continueOnError?: string | undefined;\n  enableGzip?: string | undefined;\n  publicRead?: string | undefined;\n  headers?: string | undefined;\n  enableDebug?: string | undefined;\n}\n\nexport interface RetryConfig {\n  maxRetries: number;\n  baseDelay: number;\n  maxDelay: number;\n  backoffMultiplier: number;\n}\n\nexport interface UploadOptions {\n  timeout?: number;\n  headers?: Record<string, string>;\n  gzip?: boolean;\n  'x-oss-storage-class'?: 'Standard' | 'IA' | 'Archive' | 'ColdArchive';\n  'x-oss-object-acl'?: 'private' | 'public-read' | 'public-read-write';\n  meta?: Record<string, string>;\n}\n\nexport class OSSActionError extends Error {\n  public readonly code?: string;\n  public readonly statusCode?: number;\n  public readonly filePath?: string;\n\n  constructor(\n    message: string,\n    code?: string,\n    statusCode?: number,\n    filePath?: string\n  ) {\n    super(message);\n    this.name = 'OSSActionError';\n    if (code !== undefined) this.code = code;\n    if (statusCode !== undefined) this.statusCode = statusCode;\n    if (filePath !== undefined) this.filePath = filePath;\n  }\n}\n\nexport class ValidationError extends OSSActionError {\n  constructor(message: string) {\n    super(`Validation Error: ${message}`, 'VALIDATION_ERROR');\n    this.name = 'ValidationError';\n  }\n}\n\nexport class NetworkError extends OSSActionError {\n  constructor(message: string, statusCode?: number) {\n    super(`Network Error: ${message}`, 'NETWORK_ERROR', statusCode);\n    this.name = 'NetworkError';\n  }\n}\n\nexport class FileNotFoundError extends OSSActionError {\n  constructor(filePath: string) {\n    super(`File not found: ${filePath}`, 'FILE_NOT_FOUND', undefined, filePath);\n    this.name = 'FileNotFoundError';\n  }\n}\n\nexport interface OSSResponse {\n  res?: {\n    headers?: {\n      etag?: string;\n    };\n  };\n  url?: string;\n}\n\nexport interface OSSSDKError {\n  code?: string;\n  status?: number;\n  message?: string;\n}\n","/**\n * Utility functions for OSS Action\n */\n\nimport { promises as fs } from 'fs';\nimport { basename } from 'path';\nimport * as core from '@actions/core';\nimport { ValidationError, FileNotFoundError, UploadRule, ActionInputs } from './types';\n\n/**\n * Validates required GitHub Action inputs\n */\nexport function validateInputs(inputs: ActionInputs): void {\n  const requiredFields = ['accessKey', 'secretKey', 'bucket', 'assets'];\n\n  for (const field of requiredFields) {\n    if (!inputs[field as keyof ActionInputs]) {\n      throw new ValidationError(`Required input '${field}' is missing`);\n    }\n  }\n\n  // Validate timeout\n  if (inputs.timeout) {\n    const timeout = parseInt(inputs.timeout, 10);\n    if (isNaN(timeout) || timeout <= 0) {\n      throw new ValidationError('Timeout must be a positive number');\n    }\n  }\n\n  // Validate maxRetries\n  if (inputs.maxRetries) {\n    const retries = parseInt(inputs.maxRetries, 10);\n    if (isNaN(retries) || retries < 0) {\n      throw new ValidationError('Max retries must be a non-negative number');\n    }\n  }\n}\n\n/**\n * Parses upload rules from assets string\n */\nexport function parseUploadRules(assets: string): UploadRule[] {\n  const rules: UploadRule[] = [];\n\n  for (const line of assets.split('\\n')) {\n    const trimmed = line.trim();\n    if (!trimmed) continue;\n\n    const [source, destination] = trimmed.split(':');\n    if (!source || !destination) {\n      core.warning(`‚ö†Ô∏è  Skipping invalid rule: ${trimmed}`);\n      continue;\n    }\n\n    rules.push({\n      source: source.trim(),\n      destination: destination.trim(),\n      isDirectory: destination.trim().endsWith('/')\n    });\n  }\n\n  return rules;\n}\n\n/**\n * Formats file size in human-readable format\n */\nexport function formatFileSize(bytes: number): string {\n  const units = ['B', 'KB', 'MB', 'GB', 'TB'];\n  let size = bytes;\n  let unitIndex = 0;\n\n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024;\n    unitIndex++;\n  }\n\n  return `${size.toFixed(2)} ${units[unitIndex]}`;\n}\n\n/**\n * Formats duration in human-readable format\n */\nexport function formatDuration(milliseconds: number): string {\n  const seconds = milliseconds / 1000;\n\n  if (seconds < 60) {\n    return `${seconds.toFixed(1)}s`;\n  } else if (seconds < 3600) {\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = seconds % 60;\n    return `${minutes}m ${remainingSeconds.toFixed(0)}s`;\n  } else {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    return `${hours}h ${minutes}m`;\n  }\n}\n\n/**\n * Calculates exponential backoff delay\n */\nexport function calculateBackoffDelay(\n  attempt: number,\n  baseDelay: number = 1000,\n  maxDelay: number = 10000,\n  multiplier: number = 2\n): number {\n  const delay = baseDelay * Math.pow(multiplier, attempt);\n  return Math.min(delay, maxDelay);\n}\n\n/**\n * Validates if file exists and is readable\n */\nexport async function validateFile(filePath: string): Promise<void> {\n  try {\n    const stats = await fs.stat(filePath);\n    if (!stats.isFile()) {\n      throw new FileNotFoundError(`Path is not a file: ${filePath}`);\n    }\n  } catch (error: unknown) {\n    const nodeError = error as { code?: string };\n    if (nodeError.code === 'ENOENT') {\n      throw new FileNotFoundError(filePath);\n    }\n    throw error;\n  }\n}\n\n/**\n * Gets file stats safely\n */\nexport async function getFileStats(filePath: string): Promise<{ size: number; name: string }> {\n  await validateFile(filePath);\n  const stats = await fs.stat(filePath);\n  return {\n    size: stats.size,\n    name: basename(filePath)\n  };\n}\n\n/**\n * Parses custom headers from string\n */\nexport function parseHeaders(headersString?: string): Record<string, string> {\n  if (!headersString) return {};\n\n  try {\n    return JSON.parse(headersString);\n  } catch {\n    core.warning(`‚ö†Ô∏è  Failed to parse headers JSON: ${headersString}`);\n    return {};\n  }\n}\n\n/**\n * Sanitizes remote path to ensure it's valid\n */\nexport function sanitizeRemotePath(path: string): string {\n  // Remove leading slashes and normalize\n  return path.replace(/^\\/+/, '').replace(/\\/+/g, '/');\n}\n\n/**\n * Creates a delay promise for retry backoff\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Extracts relative path from a file path based on glob pattern\n */\nexport function extractRelativePath(filePath: string, basePath: string): string {\n  // Remove glob patterns and normalize the base path\n  const base = basePath.replace(/\\*+.*$/g, '').replace(/\\/$/, '');\n\n  // If the file path starts with the base, extract the relative part\n  if (filePath.startsWith(base)) {\n    const relativePath = filePath.substring(base.length);\n    // Remove leading slash if present\n    return relativePath.startsWith('/') ? relativePath.substring(1) : relativePath;\n  }\n\n  // Fallback: just return the filename\n  return filePath.split('/').pop() || filePath;\n}\n\n/**\n * Logs operation with consistent formatting\n */\nexport function logOperation(operation: string, details?: string): void {\n  const message = details ? `${operation}: ${details}` : operation;\n  core.info(`üîß ${message}`);\n}\n\n/**\n * Logs success with consistent formatting\n */\nexport function logSuccess(message: string): void {\n  core.info(`‚úÖ ${message}`);\n}\n\n/**\n * Logs warning with consistent formatting\n */\nexport function logWarning(message: string): void {\n  core.warning(`‚ö†Ô∏è  ${message}`);\n}\n\n/**\n * Logs error with consistent formatting\n */\nexport function logError(message: string): void {\n  core.error(`‚ùå ${message}`);\n}\n\n/**\n * Logs debug information (visible when debug mode is enabled)\n *\n * Note: We use core.info() instead of core.debug() because:\n * - core.debug() often doesn't appear even in raw logs due to GitHub Actions limitations\n * - Runner-level filtering and action context issues can suppress debug output\n * - Using core.info() with conditional checking provides better visibility and control\n */\nexport function logDebug(message: string, details?: any): void {\n  if (!isDebugEnabled()) {\n    return;\n  }\n\n  if (details && typeof details === 'object') {\n    // Use core.info() instead of core.debug() for better visibility\n    core.info(`üêõ DEBUG: ${message}: ${JSON.stringify(details, null, 2)}`);\n  } else if (details !== undefined) {\n    core.info(`üêõ DEBUG: ${message}: ${details}`);\n  } else {\n    core.info(`üêõ DEBUG: ${message}`);\n  }\n}\n\n/**\n * Checks if debug mode is enabled\n */\nexport function isDebugEnabled(): boolean {\n  // Check environment variable first (GitHub Actions standard)\n  if (process.env.ACTIONS_STEP_DEBUG === 'true') {\n    return true;\n  }\n\n  // Check action input (our custom option)\n  try {\n    return core.getInput('enable-debug') === 'true';\n  } catch {\n    // If core.getInput fails (e.g., in tests), default to false\n    return false;\n  }\n}\n","/**\n * OSS Uploader class with retry logic and better error handling\n */\n\nimport OSS from 'ali-oss';\nimport { resolve, basename } from 'path';\nimport * as core from '@actions/core';\nimport fg from 'fast-glob';\nimport { existsSync, statSync } from 'fs';\nimport {\n  OSSConfig,\n  UploadRule,\n  UploadResult,\n  UploadStats,\n  RetryConfig,\n  UploadOptions,\n  OSSResponse,\n  OSSSDKError,\n  NetworkError,\n  FileNotFoundError\n} from './types';\nimport {\n  formatFileSize,\n  formatDuration,\n  calculateBackoffDelay,\n  getFileStats,\n  sanitizeRemotePath,\n  extractRelativePath,\n  delay,\n  logOperation,\n  logSuccess,\n  logWarning,\n  logError,\n  logDebug\n} from './utils';\n\nexport class OSSUploader {\n  private oss: OSS;\n  private retryConfig: RetryConfig;\n  private stats: UploadStats;\n  private config: OSSConfig;\n\n  constructor(\n    config: OSSConfig,\n    retryConfig: RetryConfig = {\n      maxRetries: 3,\n      baseDelay: 1000,\n      maxDelay: 10000,\n      backoffMultiplier: 2\n    }\n  ) {\n    this.config = config;\n    this.oss = new OSS(config);\n    this.retryConfig = retryConfig;\n    this.stats = {\n      totalFiles: 0,\n      uploadedFiles: 0,\n      failedFiles: 0,\n      totalSize: 0,\n      uploadedSize: 0,\n      totalDuration: 0,\n      successRate: 0\n    };\n  }\n\n  /**\n   * Upload files based on rules with retry logic\n   */\n  async uploadFiles(rules: UploadRule[], options: UploadOptions = {}): Promise<UploadResult[]> {\n    const results: UploadResult[] = [];\n    const startTime = Date.now();\n\n    logOperation('Starting upload process', `${rules.length} rule(s)`);\n    logDebug('Upload process started', { rulesCount: rules.length, options });\n\n    for (const rule of rules) {\n      try {\n        logDebug('Processing upload rule', { rule, ruleIndex: rules.indexOf(rule) + 1 });\n        const ruleResults = await this.processRule(rule, options);\n        results.push(...ruleResults);\n        logDebug('Rule processing completed', {\n          rule: rule.source + ' ‚Üí ' + rule.destination,\n          resultCount: ruleResults.length\n        });\n      } catch (error) {\n        logError(`Failed to process rule: ${rule.source} ‚Üí ${rule.destination}`);\n        logDebug('Rule processing failed', { rule, error: error instanceof Error ? error.message : error });\n        if (error instanceof Error) {\n          core.error(error.message);\n        }\n        this.stats.failedFiles++;\n      }\n    }\n\n    this.stats.totalDuration = Date.now() - startTime;\n    this.stats.successRate = this.stats.totalFiles > 0\n      ? (this.stats.uploadedFiles / this.stats.totalFiles) * 100\n      : 0;\n\n    this.logFinalStats();\n    return results;\n  }\n\n  /**\n   * Process a single upload rule\n   */\n  private async processRule(rule: UploadRule, options: UploadOptions): Promise<UploadResult[]> {\n    logOperation(`Processing rule`, `${rule.source} ‚Üí ${rule.destination}`);\n    logDebug('Processing upload rule', rule);\n\n    // For directory uploads, ensure source pattern includes glob to find all files\n    // But first check if the source is actually a file - if so, don't convert to directory pattern\n    let sourcePattern = rule.source;\n    if (rule.isDirectory && !sourcePattern.includes('*') && !sourcePattern.includes('?') && !sourcePattern.includes('[')) {\n      // Check if the source path exists and is a file\n      if (existsSync(sourcePattern) && statSync(sourcePattern).isFile()) {\n        // Source is a file but destination is a directory - this is valid (single file to directory)\n        // Don't modify the source pattern\n      } else {\n        // Source is not a file or doesn't exist, treat as directory pattern\n        sourcePattern = sourcePattern.endsWith('/') ? `${sourcePattern}**/*` : `${sourcePattern}/**/*`;\n        logOperation(`Converted directory pattern`, `${rule.source} ‚Üí ${sourcePattern}`);\n      }\n    }\n\n    logDebug('Searching for files with pattern', sourcePattern);\n    const files = fg.sync([sourcePattern], {\n      dot: false,\n      onlyFiles: true,\n      absolute: true\n    });\n    logDebug('Found files', { pattern: sourcePattern, count: files.length, files });\n\n    // Check if this is a specific file path that doesn't exist\n    // (as opposed to a glob pattern that legitimately finds no files)\n    const isSpecificFile = !sourcePattern.includes('*') && !sourcePattern.includes('?') && !sourcePattern.includes('[');\n\n    if (files.length === 0) {\n      if (isSpecificFile) {\n        // This is a specific file that doesn't exist - count as a failure\n        logError(`File not found: ${rule.source}`);\n        this.stats.totalFiles += 1;\n        this.stats.failedFiles += 1;\n        return [];\n      } else {\n        // This is a glob pattern that found no files - not an error\n        logWarning(`No files found matching pattern: ${sourcePattern}`);\n        return [];\n      }\n    }\n\n    this.stats.totalFiles += files.length;\n    logOperation(`Found ${files.length} file(s) to upload`);\n\n    const results: UploadResult[] = [];\n\n    if (!rule.isDirectory) {\n      // Single file upload\n      if (files.length > 1) {\n        logWarning(`Multiple files found but destination is single file. Using first file: ${files[0]}`);\n      }\n\n      const result = await this.uploadSingleFile(files[0], rule.destination, options);\n      if (result) results.push(result);\n    } else {\n      // Directory upload - process files sequentially\n      for (const file of files) {\n        let remotePath: string;\n\n        // Check if this is a single file being uploaded to a directory destination\n        if (files.length === 1 && !rule.source.includes('*') && !rule.source.includes('?') && !rule.source.includes('[')) {\n          // Single file to directory - use just the filename\n          const filename = basename(file);\n          remotePath = sanitizeRemotePath(`${rule.destination}${filename}`);\n        } else {\n          // Multiple files or glob pattern - use relative path extraction\n          const relativePath = extractRelativePath(file, rule.source);\n          remotePath = sanitizeRemotePath(`${rule.destination}${relativePath}`);\n        }\n\n        const result = await this.uploadSingleFile(file, remotePath, options);\n        if (result) results.push(result);\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Upload a single file with retry logic\n   */\n  private async uploadSingleFile(\n    localPath: string,\n    remotePath: string,\n    options: UploadOptions\n  ): Promise<UploadResult | null> {\n    try {\n      logDebug('Starting single file upload', { localPath, remotePath });\n      const fileStats = await getFileStats(localPath);\n      this.stats.totalSize += fileStats.size;\n      logDebug('File stats obtained', { localPath, size: fileStats.size, name: fileStats.name });\n\n      const result = await this.uploadWithRetry(\n        () => this.performUpload(localPath, remotePath, options),\n        localPath,\n        fileStats\n      );\n\n      if (result) {\n        this.stats.uploadedFiles++;\n        this.stats.uploadedSize += fileStats.size;\n      }\n\n      return result;\n    } catch (error) {\n      this.stats.failedFiles++;\n      logError(`Failed to upload ${localPath}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n\n      // Re-throw if it's a critical error\n      if (error instanceof FileNotFoundError) {\n        throw error;\n      }\n\n      return null;\n    }\n  }\n\n  /**\n   * Perform the actual upload with OSS\n   */\n  private async performUpload(\n    localPath: string,\n    remotePath: string,\n    options: UploadOptions\n  ): Promise<UploadResult> {\n    logDebug('Performing OSS upload', { localPath, remotePath, options });\n\n    const uploadOptions: Record<string, unknown> = {\n      timeout: options.timeout || 600000,\n      ...options\n    };\n\n    // Handle gzip compression\n    if (options.gzip) {\n      uploadOptions.headers = {\n        ...(uploadOptions.headers as Record<string, string> || {}),\n        'Content-Encoding': 'gzip'\n      };\n    }\n\n    const response = await this.oss.put(remotePath, resolve(localPath), uploadOptions);\n    logDebug('OSS upload response received', { remotePath, responseStatus: response?.res?.status });\n\n    // Handle OSS response structure safely\n    const ossResponse = response as unknown as OSSResponse;\n    const fileStats = await getFileStats(localPath);\n\n    const result = {\n      success: true,\n      filePath: localPath,\n      objectKey: remotePath,\n      size: fileStats.size,\n      ...(ossResponse.res?.headers?.etag && { etag: ossResponse.res.headers.etag }),\n      ...(ossResponse.url && { url: ossResponse.url })\n    };\n\n    logDebug('Upload result created', result);\n    return result;\n  }\n\n  /**\n   * Upload with retry logic and exponential backoff\n   */\n  private async uploadWithRetry(\n    uploadFn: () => Promise<UploadResult>,\n    _filePath: string,\n    fileStats: { size: number; name: string }\n  ): Promise<UploadResult | null> {\n    const fileSizeFormatted = formatFileSize(fileStats.size);\n    logDebug('Starting upload with retry', { fileName: fileStats.name, size: fileSizeFormatted, maxRetries: this.retryConfig.maxRetries });\n\n    for (let attempt = 0; attempt < this.retryConfig.maxRetries; attempt++) {\n      try {\n        const retryLabel = attempt > 0 ? ` - Retry ${attempt}` : '';\n        logOperation(`‚¨ÜÔ∏è  Uploading ${fileStats.name} (${fileSizeFormatted})${retryLabel}`);\n        logDebug('Upload attempt', { attempt: attempt + 1, fileName: fileStats.name });\n\n        const startTime = Date.now();\n        const result = await uploadFn();\n        const duration = Date.now() - startTime;\n\n        logSuccess(`Uploaded ${fileStats.name} in ${formatDuration(duration)}`);\n        logDebug('Upload successful', { fileName: fileStats.name, duration, attempt: attempt + 1 });\n        return result;\n\n      } catch (error: unknown) {\n        const isLastAttempt = attempt === this.retryConfig.maxRetries - 1;\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n\n        logWarning(`Upload failed for ${fileStats.name}: ${errorMessage}`);\n        logDebug('Upload attempt failed', { fileName: fileStats.name, attempt: attempt + 1, error: errorMessage, isLastAttempt });\n\n        // Convert to Error for the retry check\n        const errorObj = error instanceof Error ? error : new Error(String(error));\n\n        // Check if it's a retryable error\n        if (!this.isRetryableError(errorObj) || isLastAttempt) {\n          if (isLastAttempt) {\n            logError(`üí• All ${this.retryConfig.maxRetries} attempts failed for ${fileStats.name}`);\n          }\n          throw errorObj;\n        }\n\n        // Calculate backoff delay\n        const delayMs = calculateBackoffDelay(\n          attempt,\n          this.retryConfig.baseDelay,\n          this.retryConfig.maxDelay,\n          this.retryConfig.backoffMultiplier\n        );\n\n        logOperation(`‚è≥ Retrying in ${formatDuration(delayMs)}... (attempt ${attempt + 2}/${this.retryConfig.maxRetries})`);\n        logDebug('Retry delay calculated', { delayMs, attempt, fileName: fileStats.name });\n        await delay(delayMs);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Check if an error is retryable\n   */\n  private isRetryableError(error: Error): boolean {\n    if (error instanceof FileNotFoundError) {\n      return false; // File not found is not retryable\n    }\n\n    // Network-related errors are retryable\n    if (error instanceof NetworkError) {\n      return true;\n    }\n\n    // OSS SDK specific errors\n    const ossError = error as Error & OSSSDKError;\n    if (ossError.code) {\n      const retryableCodes = [\n        'RequestTimeout',\n        'ServiceUnavailable',\n        'Throttling',\n        'InternalError',\n        'ConnectionTimeout',\n        'SocketTimeout'\n      ];\n      return retryableCodes.includes(ossError.code);\n    }\n\n    // HTTP status codes that are retryable\n    if (ossError.status) {\n      const retryableStatuses = [408, 429, 500, 502, 503, 504];\n      return retryableStatuses.includes(ossError.status);\n    }\n\n    // Timeout errors\n    if (error.message && error.message.toLowerCase().includes('timeout')) {\n      return true;\n    }\n\n    // Default to retryable for unknown errors\n    return true;\n  }\n\n  /**\n   * Get current upload statistics\n   */\n  getStats(): UploadStats {\n    return { ...this.stats };\n  }\n\n  /**\n   * Log final upload statistics\n   */\n  private logFinalStats(): void {\n    const duration = formatDuration(this.stats.totalDuration);\n    const totalSize = formatFileSize(this.stats.totalSize);\n    const uploadedSize = formatFileSize(this.stats.uploadedSize);\n\n    logSuccess(\n      `Upload completed! ${this.stats.uploadedFiles}/${this.stats.totalFiles} files ` +\n      `(${uploadedSize}/${totalSize}) uploaded in ${duration}`\n    );\n\n    if (this.stats.failedFiles > 0) {\n      logWarning(`${this.stats.failedFiles} file(s) failed to upload`);\n    }\n  }\n\n  /**\n   * Test OSS connection\n   */\n  async testConnection(): Promise<boolean> {\n    try {\n      logDebug('Testing OSS connection', { bucket: this.config.bucket, region: this.config.region });\n      await this.oss.getBucketInfo(this.config.bucket);\n      logSuccess('OSS connection test successful');\n      logDebug('OSS connection test details', { bucket: this.config.bucket, status: 'success' });\n      return true;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      logError(`OSS connection test failed: ${errorMessage}`);\n      logDebug('OSS connection test failed', { bucket: this.config.bucket, error: errorMessage });\n      return false;\n    }\n  }\n}\n","/**\n * Main entry point for OSS GitHub Action (TypeScript)\n */\n\nimport * as core from '@actions/core';\nimport * as github from '@actions/github';\nimport { OSSUploader } from './uploader';\nimport { ActionInputs, OSSConfig, RetryConfig, UploadOptions, UploadResult, UploadStats } from './types';\nimport { validateInputs, parseUploadRules, parseHeaders, formatFileSize, formatDuration, logDebug, isDebugEnabled } from './utils';\n\n/**\n * Main action runner\n */\nasync function run(): Promise<void> {\n  const startTime = Date.now();  try {\n    core.info('üöÄ Starting OSS upload process...');\n\n    if (isDebugEnabled()) {\n      core.info('üêõ ===============================================');\n      core.info('üêõ DEBUG MODE ENABLED - Verbose logging active');\n      core.info('üêõ ===============================================');\n      logDebug('Debug mode enabled', {\n        ACTIONS_STEP_DEBUG: process.env.ACTIONS_STEP_DEBUG,\n        enableDebugInput: core.getInput('enable-debug')\n      });\n    }\n\n    // Get and validate inputs\n    const inputs = getActionInputs();\n    if (isDebugEnabled()) {\n      logDebug('Raw action inputs received', {\n        region: inputs.region,\n        bucket: inputs.bucket,\n        timeout: inputs.timeout,\n        maxRetries: inputs.maxRetries,\n        enableDebug: inputs.enableDebug,\n        assetsLength: inputs.assets.length\n      });\n    }\n    validateInputs(inputs);\n\n    // Create OSS configuration\n    const ossConfig = createOSSConfig(inputs);\n    logDebug('OSS configuration created', {\n      bucket: ossConfig.bucket,\n      region: ossConfig.region,\n      endpoint: ossConfig.endpoint,\n      timeout: ossConfig.timeout\n    });\n    logConnectionInfo(ossConfig);\n\n    // Create retry configuration\n    const retryConfig = createRetryConfig(inputs);\n    logDebug('Retry configuration', retryConfig);\n\n    // Create upload options\n    const uploadOptions = createUploadOptions(inputs);\n    logDebug('Upload options', uploadOptions);\n\n    // Initialize uploader\n    const uploader = new OSSUploader(ossConfig, retryConfig);\n\n    // Test connection (optional)\n    const connectionOk = await uploader.testConnection();\n    if (!connectionOk) {\n      core.warning('‚ö†Ô∏è  OSS connection test failed, but continuing with upload...');\n    }\n\n    // Parse upload rules\n    const rules = parseUploadRules(inputs.assets);\n    logDebug('Parsed upload rules', rules);\n    if (rules.length === 0) {\n      core.setFailed('No valid upload rules found in assets input');\n      return;\n    }\n\n    core.info(`üìã Processing ${rules.length} upload rule(s)`);\n\n    // Perform uploads\n    const results = await uploader.uploadFiles(rules, uploadOptions);\n    const stats = uploader.getStats();\n    logDebug('Upload results', { results, stats });\n\n    // Set outputs\n    await setActionOutputs(results, stats, ossConfig);\n\n    // Create job summary\n    await createJobSummary(stats, ossConfig, startTime);\n\n    // Check if we should fail on incomplete uploads\n    const continueOnError = inputs.continueOnError === 'true';\n    if (!continueOnError && stats.failedFiles > 0) {\n      core.setFailed(`Upload incomplete: ${stats.failedFiles} file(s) failed to upload`);\n      return;\n    }\n\n    const totalTime = formatDuration(Date.now() - startTime);\n    core.info(`üéâ Action completed successfully in ${totalTime}`);\n\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n    core.error(`üí• Action failed: ${errorMessage}`);\n    core.setFailed(errorMessage);\n  }\n}\n\n/**\n * Extract and parse action inputs\n */\nfunction getActionInputs(): ActionInputs {\n  return {\n    accessKey: core.getInput('access-key', { required: true }),\n    secretKey: core.getInput('secret-key', { required: true }),\n    bucket: core.getInput('bucket', { required: true }),\n    assets: core.getInput('assets', { required: true }),\n    region: core.getInput('region') || undefined,\n    endpoint: core.getInput('endpoint') || undefined,\n    timeout: core.getInput('timeout') || '120',\n    maxRetries: core.getInput('max-retries') || '3',\n    continueOnError: core.getInput('continue-on-error') || 'false',\n    enableGzip: core.getInput('enable-gzip') || 'false',\n    publicRead: core.getInput('public-read') || 'false',\n    headers: core.getInput('headers') || undefined,\n    enableDebug: core.getInput('enable-debug') || 'false'\n  };\n}\n\n/**\n * Create OSS configuration from inputs\n */\nfunction createOSSConfig(inputs: ActionInputs): OSSConfig {\n  const config: OSSConfig = {\n    accessKeyId: inputs.accessKey,\n    accessKeySecret: inputs.secretKey,\n    bucket: inputs.bucket,\n    timeout: parseInt(inputs.timeout || '600', 10) * 1000 // Convert to milliseconds\n  };\n\n  if (inputs.region) {\n    config.region = inputs.region;\n  }\n\n  if (inputs.endpoint) {\n    config.endpoint = inputs.endpoint;\n  }\n\n  return config;\n}\n\n/**\n * Create retry configuration from inputs\n */\nfunction createRetryConfig(inputs: ActionInputs): RetryConfig {\n  return {\n    maxRetries: parseInt(inputs.maxRetries || '3', 10),\n    baseDelay: 1000,\n    maxDelay: 10000,\n    backoffMultiplier: 2\n  };\n}\n\n/**\n * Create upload options from inputs\n */\nfunction createUploadOptions(inputs: ActionInputs): UploadOptions {\n  const options: UploadOptions = {\n    timeout: parseInt(inputs.timeout || '600', 10) * 1000\n  };\n\n  // Parse custom headers\n  const customHeaders = parseHeaders(inputs.headers);\n  if (Object.keys(customHeaders).length > 0) {\n    options.headers = customHeaders;\n  }\n\n  // Enable gzip compression\n  if (inputs.enableGzip === 'true') {\n    options.gzip = true;\n  }\n\n  // Set public read ACL\n  if (inputs.publicRead === 'true') {\n    options['x-oss-object-acl'] = 'public-read';\n  }\n\n  return options;\n}\n\n/**\n * Log connection information\n */\nfunction logConnectionInfo(config: OSSConfig): void {\n  core.info(`üì¶ Connecting to OSS bucket: ${config.bucket}`);\n  if (config.region) core.info(`üåç Region: ${config.region}`);\n  if (config.endpoint) core.info(`üîó Endpoint: ${config.endpoint}`);\n  core.info(`‚è±Ô∏è Timeout: ${config.timeout / 1000}s`);\n}\n\n/**\n * Set GitHub Action outputs\n */\nasync function setActionOutputs(results: UploadResult[], stats: UploadStats, config: OSSConfig): Promise<void> {\n  // Set URL outputs only if there are results\n  if (results.length > 0) {\n    core.setOutput('url', results.map(r => r.url).join(','));\n    core.setOutput('urls', JSON.stringify(results.map(r => r.url)));\n  } else {\n    core.setOutput('url', '');\n    core.setOutput('urls', JSON.stringify([]));\n  }\n\n  // Always set stats and config outputs\n  core.setOutput('count', stats.uploadedFiles.toString());\n  core.setOutput('total-files', stats.totalFiles.toString());\n  core.setOutput('uploaded-files', stats.uploadedFiles.toString());\n  core.setOutput('failed-files', stats.failedFiles.toString());\n  core.setOutput('total-size', stats.totalSize.toString());\n  core.setOutput('uploaded-size', stats.uploadedSize.toString());\n  core.setOutput('success-rate', stats.successRate.toFixed(1));\n  core.setOutput('duration', stats.totalDuration.toString());\n\n  // Set bucket info\n  core.setOutput('bucket', config.bucket);\n  core.setOutput('region', config.region || 'default');\n}\n\n/**\n * Create detailed job summary\n */\nasync function createJobSummary(stats: UploadStats, config: OSSConfig, startTime: number): Promise<void> {\n  const totalTime = formatDuration(Date.now() - startTime);\n  const totalSize = formatFileSize(stats.totalSize);\n  const uploadedSize = formatFileSize(stats.uploadedSize);\n\n  await core.summary\n    .addHeading('OSS Upload Summary üì¶')\n    .addTable([\n      [{data: 'Metric', header: true}, {data: 'Value', header: true}],\n      ['Total Files Found', stats.totalFiles.toString()],\n      ['Files Uploaded', stats.uploadedFiles.toString()],\n      ['Files Failed', stats.failedFiles.toString()],\n      ['Success Rate', `${stats.successRate.toFixed(1)}%`],\n      ['Total Size', totalSize],\n      ['Uploaded Size', uploadedSize],\n      ['Total Time', totalTime],\n      ['Bucket', config.bucket],\n      ['Region', config.region || 'default']\n    ])\n    .addDetails('GitHub Action Context', [\n      `**Repository**: ${github.context.repo.owner}/${github.context.repo.repo}`,\n      `**Workflow**: ${github.context.workflow}`,\n      `**Run ID**: ${github.context.runId}`,\n      `**SHA**: ${github.context.sha.substring(0, 7)}`\n    ].join('\\n'))\n    .write();\n}\n\n// Run the action\nif (import.meta.url === `file://${process.argv[1]}`) {\n  run().catch(error => {\n    core.setFailed(error instanceof Error ? error.message : 'Unknown error');\n    process.exit(1);\n  });\n}\n\nexport { run };\n"]}